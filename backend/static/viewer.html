<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Nexus Mobile AI â€” Stream Viewer</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#0b1220; color:#fff; margin:0; padding:20px; }
    #container { display:flex; gap:20px; align-items:flex-start; }
    #frameBox { width:420px; height:300px; background:#07101a; border-radius:8px; padding:8px; box-shadow:0 6px 18px rgba(0,0,0,.6); }
    img#streamImg { width:100%; height:100%; object-fit:contain; background:#001; border-radius:6px; }
    #log { width:420px; height:300px; overflow:auto; background:#06101a; border-radius:8px; padding:8px; }
    .btn { padding:8px 12px; margin-right:8px; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <h2>Nexus Mobile AI â€” Stream Viewer ðŸš€</h2>
  <div>
    <input id="wsUrl" style="width:480px;" value="" placeholder="wss://your-domain/ws/stream"/>
    <button id="connectBtn" class="btn">Register Viewer</button>
    <button id="clearBtn" class="btn">Clear History</button>
  </div>
  <div id="container" style="margin-top:12px;">
    <div id="frameBox">
      <img id="streamImg" src="" alt="stream frame will appear here" />
    </div>
    <div id="log"></div>
  </div>

  <script>
    const logEl = document.getElementById('log');
    const imgEl = document.getElementById('streamImg');
    const wsUrlInput = document.getElementById('wsUrl');
    const connectBtn = document.getElementById('connectBtn');
    const clearBtn = document.getElementById('clearBtn');

    // default ws suggestion (if running on same host)
    if(!wsUrlInput.value){
      const scheme = location.protocol === 'https:' ? 'wss' : 'ws';
      wsUrlInput.value = `${scheme}://${location.host}/ws/stream`;
    }

    let ws=null;
    function log(msg){ logEl.innerHTML += '['+new Date().toLocaleTimeString()+'] '+msg+'<br>'; logEl.scrollTop = logEl.scrollHeight; }

    connectBtn.onclick = () => {
      if(ws && ws.readyState === WebSocket.OPEN) {
        ws.close();
        connectBtn.textContent = 'Register Viewer';
        return;
      }
      const url = wsUrlInput.value.trim();
      if(!url) return alert('WS URL vazio');
      ws = new WebSocket(url);
      ws.onopen = () => { log('ws connected'); connectBtn.textContent = 'Disconnect Viewer'; };
      ws.onmessage = (ev) => {
        try {
          const obj = JSON.parse(ev.data);
          if(obj.type === 'frame' && obj.data){
            imgEl.src = obj.data;
            log('frame @ '+obj.timestamp);
          } else if(obj.type === 'ack') {
            log('ack @ '+obj.timestamp);
          } else {
            log('msg: '+ev.data);
          }
        } catch(e){
          log('raw msg: '+ev.data);
        }
      };
      ws.onclose = () => { log('ws closed'); connectBtn.textContent = 'Register Viewer'; };
      ws.onerror = (e) => { log('ws error'); console.error(e); };
    };

    clearBtn.onclick = () => {
      imgEl.src = '';
      logEl.innerHTML = '';
    };
  </script>
</body>
</html>
