<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Nexus Mobile AI - Stream do Gr√°fico</title>
<style>
  body {
    background-color: #0b0f16;
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    color: #fff;
    text-align: center;
  }
  header {
    background: linear-gradient(90deg, #005bea, #00c6fb);
    padding: 12px;
    font-size: 18px;
    font-weight: 600;
  }
  #status {
    font-size: 14px;
    margin-top: 6px;
  }
  #canvas-container {
    display: flex;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 80px);
  }
  #chartCanvas {
    max-width: 95vw;
    max-height: 90vh;
    border-radius: 8px;
    background: #000;
  }
</style>
</head>
<body>
  <header>
    Nexus Mobile AI - Stream do Gr√°fico
    <div id="status">‚è≥ Conectando ao stream...</div>
  </header>
  <div id="canvas-container">
    <canvas id="chartCanvas"></canvas>
  </div>

<script>
const statusEl = document.getElementById('status');
const canvas = document.getElementById('chartCanvas');
const ctx = canvas.getContext('2d');
let img = new Image();

const WS_URL = (location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host + '/ws/stream';

statusEl.innerText = "‚è≥ Conectando ao stream...";

const ws = new WebSocket(WS_URL);

ws.onopen = () => {
  statusEl.innerText = "‚úÖ Conectado ao stream";
};

ws.onmessage = (event) => {
  try {
    const data = JSON.parse(event.data);

    if (data.type === "frame" && data.data) {
      const b64 = data.data;
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        statusEl.innerText = "üì° Stream ativo (gr√°fico atualizado)";
      };
      img.src = "data:image/jpeg;base64," + b64;
    } else {
      console.log("Ignorando mensagem:", data);
    }
  } catch (e) {
    console.error("Erro ao processar frame:", e);
  }
};

ws.onerror = (err) => {
  statusEl.innerText = "‚ö†Ô∏è Erro no stream: " + err.message;
};

ws.onclose = () => {
  statusEl.innerText = "üî¥ Stream encerrado. Reconectando...";
  setTimeout(() => location.reload(), 4000);
};
</script>
</body>
</html>
